{
  "entities": {
    "Publisher": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Publisher",
      "type": "object",
      "description": "Represents a publisher within the KonimPay system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Publisher entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the publisher."
        },
        "email": {
          "type": "string",
          "description": "Email address of the publisher.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the publisher."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Preferred payment method of the publisher (e.g., bank transfer, PayPal)."
        },
        "paymentDetails": {
          "type": "string",
          "description": "Payment details for non-bank methods, such as PayPal email or Binance wallet."
        },
        "country": {
          "type": "string",
          "description": "Country for bank transfer.",
          "enum": ["Venezuela", "Colombia"]
        },
        "bankName": {
          "type": "string",
          "description": "Name of the bank for bank transfer."
        },
        "accountNumber": {
          "type": "string",
          "description": "Bank account number."
        },
        "accountType": {
          "type": "string",
          "description": "Type of bank account.",
          "enum": ["Ahorro", "Corriente"]
        },
        "accountHolderName": {
          "type": "string",
          "description": "Name of the bank account holder."
        },
        "accountHolderId": {
          "type": "string",
          "description": "ID number of the bank account holder (e.g., CÃ©dula, RIF)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the publisher was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "paymentMethod"
      ]
    },
    "Offer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Offer",
      "type": "object",
      "description": "Represents an advertising offer or campaign.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Offer entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the offer or campaign."
        },
        "payout": {
          "type": "number",
          "description": "Payout amount for the offer."
        },
        "currency": {
          "type": "string",
          "description": "Currency of the payout amount."
        },
        "publisherId": {
          "type": "string",
          "description": "Reference to Publisher. (Relationship: Publisher 1:N Offer)"
        }
      },
      "required": [
        "id",
        "name",
        "payout",
        "currency",
        "publisherId"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment made to a publisher.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "publisherId": {
          "type": "string",
          "description": "Reference to Publisher. (Relationship: Publisher 1:N Payment)"
        },
        "amount": {
          "type": "number",
          "description": "Amount paid to the publisher."
        },
        "currency": {
          "type": "string",
          "description": "Currency of the payment amount."
        },
        "paymentDate": {
          "type": "string",
          "description": "Date when the payment was made.",
          "format": "date-time"
        },
        "paymentMethod": {
          "type": "string",
          "description": "Method used for the payment (e.g., bank transfer, PayPal)."
        },
        "receiptId": {
          "type": "string",
          "description": "Reference to Receipt. (Relationship: Receipt 1:1 Payment)"
        },
        "notes": {
          "type": "string",
          "description": "Any notes related to this payment."
        }
      },
      "required": [
        "id",
        "publisherId",
        "amount",
        "currency",
        "paymentDate",
        "paymentMethod"
      ]
    },
    "Receipt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Receipt",
      "type": "object",
      "description": "Represents a payment receipt.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Receipt entity."
        },
        "filename": {
          "type": "string",
          "description": "Name of the receipt file."
        },
        "fileType": {
          "type": "string",
          "description": "Type of the receipt file (e.g., PDF, JPG)."
        },
        "fileSize": {
          "type": "number",
          "description": "Size of the receipt file in bytes."
        },
        "uploadDate": {
          "type": "string",
          "description": "Date when the receipt was uploaded.",
          "format": "date-time"
        },
        "filePath": {
          "type": "string",
          "description": "Path to the receipt file on the server."
        }
      },
      "required": [
        "id",
        "filename",
        "fileType",
        "fileSize",
        "uploadDate",
        "filePath"
      ]
    },
    "Lead": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lead",
      "type": "object",
      "description": "Represents a number of leads for a specific publisher and offer on a given day.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lead entry."
        },
        "publisherId": {
          "type": "string",
          "description": "Reference to the Publisher."
        },
        "offerId": {
          "type": "string",
          "description": "Reference to the Global Offer."
        },
        "date": {
          "type": "string",
          "description": "The date the leads were recorded.",
          "format": "date"
        },
        "count": {
          "type": "number",
          "description": "The number of leads generated."
        }
      },
      "required": [
        "id",
        "publisherId",
        "offerId",
        "date",
        "count"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/publishers/{publisherId}",
        "definition": {
          "entityName": "Publisher",
          "schema": {
            "$ref": "#/backend/entities/Publisher"
          },
          "description": "Stores publisher information. Includes the publisherId as a document ID.",
          "params": [
            {
              "name": "publisherId",
              "description": "Unique identifier for the publisher."
            }
          ]
        }
      },
      {
        "path": "/publishers/{publisherId}/offers/{offerId}",
        "definition": {
          "entityName": "Offer",
          "schema": {
            "$ref": "#/backend/entities/Offer"
          },
          "description": "Stores offers related to a specific publisher. Uses publisherId to establish the relationship.",
          "params": [
            {
              "name": "publisherId",
              "description": "Unique identifier for the publisher."
            },
            {
              "name": "offerId",
              "description": "Unique identifier for the offer."
            }
          ]
        }
      },
      {
        "path": "/receipts/{receiptId}",
        "definition": {
          "entityName": "Receipt",
          "schema": {
            "$ref": "#/backend/entities/Receipt"
          },
          "description": "Stores payment receipts. Includes the receiptId as a document ID.",
          "params": [
            {
              "name": "receiptId",
              "description": "Unique identifier for the receipt."
            }
          ]
        }
      },
      {
        "path": "/leads/{leadId}",
        "definition": {
          "entityName": "Lead",
          "schema": {
            "$ref": "#/backend/entities/Lead"
          },
          "description": "Stores daily lead counts for publishers and offers.",
          "params": [
            {
              "name": "leadId",
              "description": "Unique identifier for the lead entry."
            }
          ]
        }
      },
      {
        "path": "/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores payment information for each publisher. This is a top-level collection for admin management.",
          "params": [
            {
              "name": "paymentId",
              "description": "Unique identifier for the payment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the KonimPay application, focusing on managing publishers, offers, payments, and receipts. The structure prioritizes Authorization Independence by avoiding hierarchical authorization dependencies (`get()`). All collections are designed to have homogeneous security requirements.\n\n**Authorization Independence and QAPs (Rules are not Filters):**\n\n*   The data structure uses explicit path-based ownership and segregation of data to enforce clear authorization boundaries. For example, publisher data is stored directly under the `/publishers` collection.\n*   This structure ensures that list operations are secure because rules can validate based on the current document's fields without needing to fetch data from parent documents or related collections.\n\n**Collection Structure:**\n\n*   **/publishers:** Stores publisher information.\n*   **/publishers/{publisherId}/offers:** Stores offers related to each publisher. The `publisherId` field in the offer document establishes the relationship. This enables efficient querying of offers for a specific publisher.\n*   **/receipts/{receiptId}:** Stores receipts. Includes the `publisherId` field to link the receipt to a specific publisher.\n*   **/leads/{leadId}:** New top-level collection to store lead generation records. This flat structure simplifies administrative queries for reporting and lead management across all publishers and offers.\n*   **/payments/{paymentId}:** A new top-level collection to store all generated payment records. This allows the administrator to query all payments across all publishers easily, while rules can still be enforced to allow publishers to only see their own."
  }
}
